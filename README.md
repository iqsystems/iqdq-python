# iqdq-python

## Библиотека для доступа к сервису валидации данных [iqdq.ru](https://iqdq.ru/)

Библиотека представляет собою "обертку" вокруг API сервиса и позволяет производить: 
1. Разбор, валидацию и поиск почтовых адресов для России, Беларуси, Украины и Казахстана на основе эталонных справочников:
    * Проверка адреса, метод API CheckAddress.
    * Поиск подходящих адреоов, метод API SearchAddressDetail
2. Валидацию телефонных номеров  

Остальные методы API не используются. Полная документация по API доступна [здесь](https://www.iqdq.ru/ru-RU/home/index)


### Установка
Доступна через репозиторий пакетов Python под именем iqdq
```
pip install iqdq
```
Зависимости: requests


### Использование
Для выполнения запросов к API следует создать экземпляр класса IQDQ, указав имя пользователя и пароль, полученные при регистрации не сервере [iqdq.ru](https://iqdq.ru/)
```
import iqdq

validator = iqdq.IQDQ('klim_chugunkin', 'fhe64mnd&d')
```

Для валидации используются методы:
1. **check_address(address [, country])** - валидация адреса. Опционально задается код страны - RU,BE,KZ или UA. По умолчанию - RU
2. **search_address_detail(address [, country='RU'])** - поиск наиболее подходящих адресов
3. **search_address_details(address [, country='RU'])** - синоним для search_address_detail
4. **check_phone(phone [, areas=None])** - проверка и форматирование телефонного номера. Опционально - строка, список через запятую кодов КЛАДР, которым предположительно соответствует номер.

Все методы возвращают экземпляр класса **IQDQresponse**
```
response = validator.check_address('Москва, Красная пл. д. 1')
```

Свойства класса IQDQresponse:
1. **status** - cтатус запроса и наличие результата. Может принимать следующие значения:
    * *iqdq.FOUND* - запрос успешно обработан, элемент найден
    * *iqdq.NOTFOUND* - запрос успешно обработан, элемент не найден
    * *iqdq.ERROR* - при запросе произошла ошибка, результат не получен
2. **message** - сообщение к статусу. При ошибке содержит код/описание ошибки
3. **result** - результат запроса типа list(). Если ответ содержит единственный элемент - возвращается список из одного элемента. Структура данных соответствует структуре JSON ответа из [документации по API](https://www.iqdq.ru/ru-RU/home/index)

Методы класса IQDQresponse:
1. **ok()** - True если запрос успешно обработан, иначе - False
2. **found()** - True если запрос успешно обработан и результат найден, иначе - False
3. **count()** - число записей в полученном результате
4. **pretty()** - вовзращает полную структуру result, отформатированную для удобного восприятия
```
if response.found():
    print "Ответ получен, количество записей:", response.count()
    print response.pretty()     
elif response.ok():             
    print "Результат не найден"
else:
    print "Произошла ошибка. Сообщение:", response.message
```

### That's all folks!
